# Permission to use, copy, modify, and/or distribute this software for
# any purpose with or without fee is hereby granted.
#
# THE SOFTWARE IS PROVIDED “AS IS” AND THE AUTHOR DISCLAIMS ALL
# WARRANTIES WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES
# OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE
# FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY
# DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN
# AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT
# OF OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.

# configure - configure build script

#!/bin/sh

usage()
{
	echo "usage: configure [OPTION]...
options:
	--debug		configure CFLAGS for debugging
	--help		print this message
	--nodefault	exclude all utilites from compilation
	--core		include core utilites to compilation
	--all		include all utilites to compilation

envrionments:
	CC		c compiler (cc by default)
	CFLAGS		c compiler flags
	LDFLAGS		linker flags
	CPPFLAGS	c preprocessor flags
	INCLUDE		aditional utilites to compile
	DESTDIR		installation destination directory (by default /)
	PREFIX		installation path inside destination directory (by default empty)"

	exit 0
}

CORE="true false uname wc"

while test $# -gt 0; do
	case "$1" in
		--help) usage
			;;
		--debug) CFLAGS="${CFLAGS} -g -fsanitize=address -O0"
			;;
		--nodefault) SUBDIRS=" "
			;;
		--core) SUBDIRS="${SUBDIRS} ${CORE}"
			;;
		--all) SUBDIRS="${CORE}"
			;;
	esac
	shift
done

CC=${CC:-cc}
CFLAGS=${CFLAGS:-}
LDFLAGS=${LDFLAGS:-}
CPPFLAGS=${CPPFLAGS:-}
INCLUDE=${INCLUDE:-}
SUBDIRS=${SUBDIRS:-${CORE}}
DESTDIR=${DESTDIR:-/}
PREFIX=${PREFIX:-}

eval "echo \"$(cat config.mk.in)\"" > config.mk
